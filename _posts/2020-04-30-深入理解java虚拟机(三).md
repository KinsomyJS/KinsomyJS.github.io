---
layout:     post                    # 使用的布局（不需要改）
title:   深入理解java虚拟机(三)          # 标题 
subtitle:   deep in JVM #副标题
date:       2019-04-30            # 时间
author:     Kinsomy                      # 作者
header-img:    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - JVM
    - Java
---
# 类加载机制
类加载过程的生命周分为七个阶段：加载、验证、准备、解析、初始化、使用、卸载。

验证、准备、解析三个阶段成为连接。

## 1. 类加载的时机
### 1.1 加载
虚拟机规范中没有明确规定加载时机，由不同的虚拟机实现自行决定。

### 1.2 初始化
下面5种情况必须立即初始化：

1）遇到new、getstatic、putstatic或invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。生成这4条指令的最常见的Java代码场景是：使用new关键字实例化对象的时候、读取或设置一个类的静态字段（被final修饰、已在编译期把结果放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。

2）使用java.lang.reflect包的方法对类进行反射调用的时候，如果类没有进行过初始化，则需要先触发其初始化。

3）当初始化一个类的时候，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。

4）当虚拟机启动时，用户需要指定一个要执行的主类（包含main()方法的那个类），虚拟机会先初始化这个主类。

5）当使用JDK 1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先触发其初始化。

摘录来自: 周志明. “深入理解Java虚拟机：JVM高级特性与最佳实践。” iBooks. 

下面几种情况不会触发类的初始化：
* 通过子类引用父类的静态变量
* 定义类的数组，如SampleObj[] array = new SampleObj[10]
* 常量在编译阶段会存入调用类的常量池中，没有直接引用定义常量的类


## 类加载的过程


### 参考资料
* 深入理解Java虚拟机：JVM高级特性与最佳实践