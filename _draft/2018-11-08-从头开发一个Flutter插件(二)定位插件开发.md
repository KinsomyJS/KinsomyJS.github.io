---
layout:     post                    # 使用的布局（不需要改）
title:      从头开发一个Flutter插件（二）高德地图定位插件              # 标题 
subtitle:   flutter package  #副标题
date:       2018-11-08              # 时间
author:     Kinsomy                      # 作者
header-img:    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签   
    - dart
    - flutter
    - android

---

 在上一篇文章[从头开发一个Flutter插件（一）开发流程](https://juejin.im/post/5bdfa3d151882534d44e1eca)里具体介绍了flutter插件的具体开发流程，从创建项目到发布。接下来将会为[Flutter天气](https://github.com/KinsomyJS/muses_weather_flutter)项目开发一个基于高德定位sdk的flutter定位插件。

### 申请key
 首先先进入到[高德地图定位sdk文档](https://lbs.amap.com/api/android-location-sdk/locationsummary/)内下载定位sdk，并按要求申请app key,这里不多做介绍，文档已经很详细了

 ### 配置环境
 sdk文档里同样有关于配置工程的demo,但是因为flutter 插件项目不是一个android工程，所以会有所区别。大致分以下几步：

 #### 1.集成远程依赖
```
compile 'com.amap.api:location:latest.integration'
```

#### 2.配置app key
在AndroidManifest.xml的application标签中配置Key：
```xml
<meta-data android:name="com.amap.api.v2.apikey" 
    android:value="您的Key">
</meta-data>
```

#### 3.声明service
在application标签中声明service组件：

```xml
<service android:name="com.amap.api.location.APSService"></service>
```
#### 4.声明权限

![](../img/2018-11-09-1.png)

flutter插件的目的就是隔离对sdk native code的实现，让使用者直接使用dart代码就可以获得到sdk提供的定位信息，插件和使用者交互的代码是在libs下的dart文件中提供的接口。
插件的android文件夹下面是一个完整的android工程结构，我们在这个工程下完成上述的四步。唯一一点不同的是，**配置app key**利用gradle里的manifestPlaceholders属性为用户预留，让用户自己来填写。

于是**配置app key**改写成：
```xml
<meta-data
    android:name="com.amap.api.v2.apikey"
    ndroid:value="${LOCATION_APP_KEY}"/>
```

这个**LOCATION_APP_KEY**，使用者使用插件的时候在自己flutter项目的android工程下的app/build.gradle文件里填写自己申请的高德key即可。
```gradle
android {
    compileSdkVersion 27

    lintOptions {
       ...
    }

    defaultConfig {
        ...
        manifestPlaceholders = [
                LOCATION_APP_KEY : "b947abf0a6820efedc65d06428f14281", /// 高德地图key
        ]
    }
}
```

到目前为止，一个基于高德sdk的定位插件工程就算配置好了，下面就是实现部分。





    
 


